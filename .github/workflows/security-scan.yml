name: Cloud Security Scan

on: [push, pull_request]

jobs:
  security:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§¾ Checkout code
        uses: actions/checkout@v3

      - name: ğŸ” Scan for secrets with Gitleaks
        uses: gitleaks/gitleaks-action@v2

      - name: ğŸ›¡ï¸ tfsec - Terraform static analysis
        uses: aquasecurity/tfsec-action@v1.0.0
        with:
          working_directory: ./terraform

      - name: ğŸ” checkov - Terraform security scan
        uses: bridgecrewio/checkov-action@master
        with:
          directory: ./terraform

      - name: ğŸ” semgrep - Static code analysis with custom config
        uses: returntocorp/semgrep-action@v1
        with:
          config: .semgrep.yml

      # Optional: Slack notification after scan (requires SLACK_WEBHOOK_URL secret)
      # - name: ğŸ“¢ Send Slack Notification (optional)
      #   if: success()
      #   run: |
      #     curl -X POST -H 'Content-type: application/json' \
      #       --data '{"text":"âœ… Security scan completed successfully!"}' \
      #       ${{ secrets.SLACK_WEBHOOK_URL }}
